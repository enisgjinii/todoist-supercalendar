<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Modern Todoist-Like Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
    <style>
        body {
            background-color: #fdfdfd;
            overflow-x: hidden;
        }

        #sidebar {
            width: 240px;
            min-height: 100vh;
            background-color: #f8f9fa;
            transition: margin 0.3s;
            border-right: 1px solid #ddd;
        }

        #sidebar.hide {
            margin-left: -240px;
        }

        @media (max-width: 767px) {
            #sidebar {
                margin-left: -240px;
            }

            #sidebar.show {
                margin-left: 0;
            }
        }

        .alert-area {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1080;
            min-width: 280px;
        }

        .fade-anim {
            animation: fadeIn 0.4s forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        footer {
            background-color: #f8f9fa;
            border-top: 1px solid #ddd;
        }

        .task-card {
            background-color: #fff;
            border-radius: 5px;
            padding: 8px 10px;
            margin-bottom: 8px;
            border-left: 4px solid #e2e2e2;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
            transition: background-color 0.2s;
            cursor: grab;
        }

        .task-card.done {
            background-color: #f1f1f1;
            color: #888;
            text-decoration: line-through;
            border-color: #d1d1d1;
        }

        .task-card:hover {
            background-color: #f9f9f9;
        }

        .task-dropzone {
            min-height: 60px;
            border: 2px dashed #ccc;
            border-radius: 5px;
            padding: 6px;
            margin-bottom: 12px;
            transition: background-color 0.2s;
        }

        .task-dropzone.drag-over {
            background-color: #eef7ff;
            border-color: #86b7fe;
        }

        .section-col {
            border: 1px solid #e2e2e2;
            border-radius: 4px;
            margin-bottom: 1rem;
            background-color: #fafafa;
        }

        .section-header {
            background-color: #f1f3f5;
            padding: 0.75rem;
            font-weight: 500;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .kanban-col {
            min-height: 200px;
            border: 1px dashed #ccc;
            border-radius: 5px;
            padding: 8px;
            background-color: #fff;
        }

        .sub-task {
            margin-left: 1.25rem;
            padding-left: 0.75rem;
            border-left: 2px dotted #ccc;
        }

        .extended-info {
            font-size: 0.85rem;
            color: #666;
            margin-top: 4px;
        }

        .navbar-brand {
            font-weight: 500;
        }
    </style>
</head>

<body>
    <div class="alert-area" id="alertArea"></div>
    <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
        <div class="container-fluid">
            <button class="btn btn-outline-secondary" id="toggleSidebar">
                <i class="bi bi-list"></i>
            </button>
            <a class="navbar-brand ms-2" href="#" id="goDashboard">
                <i class="bi bi-speedometer2"></i> Todoist-Like
            </a>
            <div class="ms-auto d-flex align-items-center">
                <div class="me-3 text-end" id="userInfo" style="white-space: nowrap;"></div>
                <input type="text" class="form-control form-control-sm me-2" id="apiKeyInput" placeholder="API Key"
                    style="width:220px;" />
                <button class="btn btn-primary btn-sm me-2" id="fetchBtn">
                    <i class="bi bi-download"></i> Fetch
                </button>
                <button class="btn btn-danger btn-sm" id="logoutBtn">
                    <i class="bi bi-box-arrow-right"></i> Logout
                </button>
            </div>
        </div>
    </nav>
    <div class="container-fluid">
        <div class="row">
            <nav id="sidebar" class="col-md-2 d-md-block sidebar pt-3">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-page="dashboard">
                            <i class="bi bi-speedometer2"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <span class="nav-link fw-bold">Projects</span>
                        <ul id="projectsList" class="nav flex-column ms-3"></ul>
                    </li>
                </ul>
            </nav>
            <main class="col-md-10 ms-sm-auto col-lg-10 px-md-4" id="mainContent"></main>
        </div>
    </div>
    <footer class="text-center p-3 mt-4">
        <small class="text-muted">&copy; 2025 - Elegant Todoist-Like Dashboard</small>
    </footer>
    <script>
        let apiKey = localStorage.getItem("todoistApiKey") || "";
        let userData = null;
        let projectsData = [];
        let tasksData = [];
        let sectionsData = [];
        let completedTasksData = [];
        const toggleSidebarBtn = document.getElementById("toggleSidebar");
        const sidebar = document.getElementById("sidebar");
        const fetchBtn = document.getElementById("fetchBtn");
        const logoutBtn = document.getElementById("logoutBtn");
        const apiKeyInput = document.getElementById("apiKeyInput");
        const mainContent = document.getElementById("mainContent");
        const projectsList = document.getElementById("projectsList");
        const goDashboardLink = document.getElementById("goDashboard");
        const userInfo = document.getElementById("userInfo");
        const alertArea = document.getElementById("alertArea");
        if (apiKey) apiKeyInput.value = apiKey;
        toggleSidebarBtn.onclick = () => {
            if (window.innerWidth < 768) {
                sidebar.classList.toggle("show");
            } else {
                sidebar.classList.toggle("hide");
            }
        };
        fetchBtn.onclick = async () => {
            apiKey = apiKeyInput.value.trim();
            if (!apiKey) {
                showAlert("Please enter API Key", "warning");
                return;
            }
            localStorage.setItem("todoistApiKey", apiKey);
            try {
                await fetchUser();
                await fetchProjects();
                await fetchTasks();
                await fetchSections();
                await fetchCompletedTasksLastMonth();
                renderSidebarProjects();
                renderDashboard();
                showAlert("Data fetched successfully!", "success");
            } catch (err) {
                showAlert("Error: " + err.message, "danger");
            }
        };
        logoutBtn.onclick = () => {
            localStorage.removeItem("todoistApiKey");
            apiKey = "";
            userData = null;
            projectsData = [];
            tasksData = [];
            sectionsData = [];
            completedTasksData = [];
            apiKeyInput.value = "";
            userInfo.innerHTML = "";
            mainContent.innerHTML = "<p class='mt-3'>Logged out.</p>";
            showAlert("Logged out.", "info");
        };
        goDashboardLink.onclick = (e) => {
            e.preventDefault();
            renderDashboard();
        };
        document.addEventListener("click", (e) => {
            if (e.target.matches("[data-page='dashboard']")) {
                e.preventDefault();
                renderDashboard();
            }
            if (e.target.matches("[data-project-id]")) {
                e.preventDefault();
                const pid = e.target.getAttribute("data-project-id");
                renderProjectViews(pid);
            }
            if (e.target.closest("[data-project-id]")) {
                e.preventDefault();
                const pid = e.target.closest("[data-project-id]").getAttribute("data-project-id");
                renderProjectViews(pid);
            }
            if (e.target.matches(".addTaskBtn")) {
                e.preventDefault();
                const container = e.target.closest(".tasks-container");
                if (container) {
                    showAlert("Add New Task form not implemented in this demo.", "info");
                }
            }
        });
        async function fetchUser() {
            const url = "https://api.todoist.com/sync/v9/user";
            const res = await fetch(url, { headers: { Authorization: "Bearer " + apiKey } });
            if (!res.ok) throw new Error("User info error");
            userData = await res.json();
            if (userData.email) {
                userInfo.innerHTML = `
          <small class="text-muted">${userData.full_name || ""}</small><br/>
          <small class="fw-bold">${userData.email}</small>
        `;
            }
        }
        async function fetchProjects() {
            const url = "https://api.todoist.com/rest/v2/projects";
            const res = await fetch(url, { headers: { Authorization: "Bearer " + apiKey } });
            if (!res.ok) throw new Error("Projects error");
            projectsData = await res.json();
        }
        async function fetchTasks() {
            const url = "https://api.todoist.com/rest/v2/tasks";
            const res = await fetch(url, { headers: { Authorization: "Bearer " + apiKey } });
            if (!res.ok) throw new Error("Tasks error");
            tasksData = await res.json();
        }
        async function fetchSections() {
            const url = "https://api.todoist.com/rest/v2/sections";
            const res = await fetch(url, { headers: { Authorization: "Bearer " + apiKey } });
            if (!res.ok) throw new Error("Sections error");
            sectionsData = await res.json();
        }
        async function fetchCompletedTasksLastMonth() {
            const sinceDate = new Date();
            sinceDate.setDate(sinceDate.getDate() - 30);
            const url = "https://api.todoist.com/sync/v9/completed/get_all?limit=200&since=" + encodeURIComponent(sinceDate.toISOString());
            const res = await fetch(url, { headers: { Authorization: "Bearer " + apiKey } });
            if (!res.ok) throw new Error("Completed tasks error");
            const data = await res.json();
            completedTasksData = data.items || [];
        }
        function renderSidebarProjects() {
            projectsList.innerHTML = "";
            projectsData.forEach((p) => {
                const li = document.createElement("li");
                li.className = "nav-item";
                li.innerHTML = `
          <a class="nav-link" href="#" data-project-id="${p.id}">
            <i class="bi bi-folder"></i> ${p.name}
          </a>`;
                projectsList.appendChild(li);
            });
        }
        function renderDashboard() {
            mainContent.innerHTML = `
        <div class="fade-anim">
          <div class="row my-4">
            <div class="col-lg-6 mb-4">
              <div class="card border-primary">
                <div class="card-header bg-primary text-white">
                  <i class="bi bi-bar-chart"></i> Tasks by Priority
                </div>
                <div class="card-body">
                  <div id="chartExample" style="height:350px;"></div>
                </div>
              </div>
            </div>
            <div class="col-lg-6 mb-4">
              <div class="card border-success">
                <div class="card-header bg-success text-white">
                  <i class="bi bi-calendar-event"></i> Calendar
                </div>
                <div class="card-body">
                  <div id="calendarExample"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col mb-4">
              <div class="card border-warning">
                <div class="card-header bg-warning">
                  <i class="bi bi-check-all"></i> Completed (30 Days)
                </div>
                <div class="card-body" id="completedTasksContainer"></div>
              </div>
            </div>
          </div>
        </div>`;
            setTimeout(() => {
                renderChart();
                renderCalendar();
                renderCompletedList();
            }, 50);
            fadeInContent();
        }
        function renderChart() {
            const priorityCount = { 1: 0, 2: 0, 3: 0, 4: 0 };
            tasksData.forEach((t) => {
                if (!t.priority) priorityCount[4]++;
                else priorityCount[t.priority] = (priorityCount[t.priority] || 0) + 1;
            });
            const options = {
                chart: { type: "bar" },
                colors: ["#0d6efd"],
                xaxis: { categories: ["P1", "P2", "P3", "P4"] },
                series: [
                    {
                        name: "Tasks",
                        data: [
                            priorityCount[1],
                            priorityCount[2],
                            priorityCount[3],
                            priorityCount[4],
                        ],
                    },
                ],
            };
            const el = document.getElementById("chartExample");
            el.innerHTML = "";
            const chart = new ApexCharts(el, options);
            chart.render();
        }
        function renderCalendar() {
            const calEl = document.getElementById("calendarExample");
            const events = tasksData
                .filter((t) => t.due && t.due.date)
                .map((t) => ({
                    title: t.content,
                    start: t.due.date,
                }));
            const calendar = new FullCalendar.Calendar(calEl, {
                initialView: "dayGridMonth",
                events,
            });
            calendar.render();
        }
        function renderCompletedList() {
            const container = document.getElementById("completedTasksContainer");
            if (!completedTasksData.length) {
                container.innerHTML = "<p class='text-muted'>No completed tasks in the last 30 days.</p>";
                return;
            }
            let html = "<ul class='list-group'>";
            completedTasksData.forEach((item) => {
                html += `<li class="list-group-item task-card done mb-2">${item.content}</li>`;
            });
            html += "</ul>";
            container.innerHTML = html;
        }
        function renderProjectViews(pid) {
            const project = projectsData.find((p) => p.id == pid);
            mainContent.innerHTML = `
        <div class="fade-anim">
          <div class="d-flex align-items-center mt-3 mb-2">
            <h4 class="mb-0 flex-grow-1">
              <i class="bi bi-kanban"></i> ${project ? project.name : "Project"} 
            </h4>
          </div>
          <div class="btn-group mb-3">
            <button class="btn btn-outline-primary" data-view="sections">Sections</button>
            <button class="btn btn-outline-primary" data-view="board">Board</button>
            <button class="btn btn-outline-primary" data-view="list">List</button>
            <button class="btn btn-outline-primary" data-view="calendar">Calendar</button>
            <button class="btn btn-outline-primary" data-view="gantt">Gantt</button>
            <button class="btn btn-outline-primary" data-view="kanban">Kanban</button>
            <button class="btn btn-outline-primary" data-view="timeline">Timeline</button>
            <button class="btn btn-outline-primary" data-view="stats">Stats</button>
            <button class="btn btn-outline-primary" data-view="priority">Priority</button>
            <button class="btn btn-outline-primary" data-view="overdue">Overdue</button>
          </div>
          <div id="projectViewContainer"></div>
        </div>`;
            document.querySelectorAll("[data-view]").forEach((btn) => {
                btn.onclick = () => showProjectView(pid, btn.getAttribute("data-view"));
            });
            fadeInContent();
        }
        function showProjectView(pid, view) {
            const container = document.getElementById("projectViewContainer");
            container.classList.remove("fade-anim");
            const projTasks = tasksData.filter((t) => t.project_id == pid);
            if (view === "sections") {
                container.innerHTML = renderSectionsView(pid, projTasks);
            } else if (view === "board") {
                container.innerHTML = renderBoardView(projTasks);
            } else if (view === "list") {
                container.innerHTML = renderListView(projTasks);
            } else if (view === "calendar") {
                container.innerHTML = `<div id="projCalendar" style="min-height:400px;"></div>`;
                setTimeout(() => renderProjectCalendar(projTasks), 50);
            } else if (view === "gantt") {
                container.innerHTML = `<div id="ganttChart" style="min-height:400px;"></div>`;
                setTimeout(() => renderGanttView(projTasks), 50);
            } else if (view === "kanban") {
                container.innerHTML = renderKanbanView(projTasks);
            } else if (view === "timeline") {
                container.innerHTML = `<div id="timelineChart" style="min-height:400px;"></div>`;
                setTimeout(() => renderTimelineView(projTasks), 50);
            } else if (view === "stats") {
                container.innerHTML = `<div id="statsChart" style="height:400px;"></div>`;
                setTimeout(() => renderStatsView(projTasks), 50);
            } else if (view === "priority") {
                container.innerHTML = renderPriorityView(projTasks);
            } else if (view === "overdue") {
                container.innerHTML = renderOverdueView(projTasks);
            } else {
                container.innerHTML = `<p class='text-muted'>Not implemented yet.</p>`;
            }
            setTimeout(() => container.classList.add("fade-anim"), 20);
            initDragDrop();
        }
        function renderSectionsView(pid, tasks) {
            const relatedSections = sectionsData.filter((s) => s.project_id == pid);
            if (!relatedSections.length) return "<p class='text-muted'>No sections found.</p>";
            let html = "<div class='row'>";
            relatedSections.forEach((sec) => {
                const secTasks = tasks.filter((t) => String(t.section_id) === String(sec.id));
                html += `
          <div class="col-md-4 section-col tasks-container mb-3">
            <div class="section-header">
              <span>${sec.name}</span>
              <button class="btn btn-sm btn-outline-success addTaskBtn">
                <i class="bi bi-plus-circle"></i> Add Task
              </button>
            </div>
            <div class="p-2 task-dropzone" data-section-id="${sec.id}">
              ${secTasks.map((t) => renderTaskCard(t, isTaskDone(t))).join("")}
            </div>
          </div>`;
            });
            html += "</div>";
            return html;
        }
        function renderBoardView(tasks) {
            const todo = tasks.filter((t) => !isTaskDone(t));
            const done = tasks.filter((t) => isTaskDone(t));
            return `
        <div class="row tasks-container">
          <div class="col-md-6 mb-4">
            <h5 class="mb-2">To Do (${todo.length})</h5>
            <div class="task-dropzone" data-status="todo">
              ${todo.map((t) => renderTaskCard(t)).join("")}
            </div>
            <button class="btn btn-sm btn-outline-success addTaskBtn mt-2">
              <i class="bi bi-plus-circle"></i> Add Task
            </button>
          </div>
          <div class="col-md-6 mb-4">
            <h5 class="mb-2">Done (${done.length})</h5>
            <div class="task-dropzone" data-status="done">
              ${done.map((t) => renderTaskCard(t, true)).join("")}
            </div>
            <button class="btn btn-sm btn-outline-success addTaskBtn mt-2">
              <i class="bi bi-plus-circle"></i> Add Task
            </button>
          </div>
        </div>`;
        }
        function renderListView(tasks) {
            if (!tasks.length) return "<p>No tasks.</p>";
            const map = new Map();
            tasks.forEach((t) => {
                if (!t.parent_id) map.set(t.id, { ...t, children: [] });
            });
            tasks.forEach((t) => {
                if (t.parent_id) {
                    const parent = map.get(t.parent_id);
                    if (parent) parent.children.push(t);
                    else map.set(t.id, { ...t, children: [] });
                }
            });
            let html = `<div class="tasks-container">`;
            html += `<button class="btn btn-sm btn-outline-success addTaskBtn mb-2">
        <i class="bi bi-plus-circle"></i> Add Task
      </button>`;
            html += "<ul class='list-group'>";
            map.forEach((task) => {
                html += buildListItem(task);
            });
            html += "</ul></div>";
            return html;
        }
        function buildListItem(t) {
            const doneClass = isTaskDone(t) ? "done" : "";
            return `
        <li class="list-group-item task-card ${doneClass}" draggable="true" data-task-id="${t.id}">
          <div><strong>${t.content}</strong></div>
          <div class="extended-info">
            ${t.description ? `Desc: ${t.description}<br/>` : ""}
            ${t.due ? `Due: ${t.due.date || ""} ${t.due.datetime || ""}<br/>` : ""}
            Priority: P${t.priority || 4}
          </div>
          ${renderChildren(t.children)}
        </li>`;
        }
        function renderChildren(children) {
            if (!children || !children.length) return "";
            let html = `<ul class="list-group mt-1">`;
            children.forEach((c) => {
                const doneClass = isTaskDone(c) ? "done" : "";
                html += `<li class="list-group-item sub-task task-card ${doneClass}" draggable="true" data-task-id="${c.id}">
          <div><strong>${c.content}</strong></div>
          <div class="extended-info">
            ${c.description ? `Desc: ${c.description}<br/>` : ""}
            ${c.due ? `Due: ${c.due.date || ""} ${c.due.datetime || ""}<br/>` : ""}
            Priority: P${c.priority || 4}
          </div>
        </li>`;
            });
            html += "</ul>";
            return html;
        }
        function renderTaskCard(t, done = false) {
            const doneClass = done ? "done" : "";
            const desc = t.description ? `<div><small>${t.description}</small></div>` : "";
            const due = t.due ? `<div><small>Due: ${t.due.date || ""} ${t.due.datetime || ""}</small></div>` : "";
            return `
        <div 
          class="task-card mb-2 ${doneClass}" 
          draggable="true" 
          data-task-id="${t.id}"
        >
          <strong>${t.content}</strong>
          ${desc}
          ${due}
          <small>Priority: P${t.priority || 4}</small>
        </div>`;
        }
        function renderProjectCalendar(tasks) {
            const calEl = document.getElementById("projCalendar");
            const events = tasks
                .filter((t) => t.due && t.due.date)
                .map((t) => ({
                    title: t.content,
                    start: t.due.date,
                }));
            const calendar = new FullCalendar.Calendar(calEl, {
                initialView: "dayGridMonth",
                events,
            });
            calendar.render();
        }
        function renderGanttView(tasks) {
            const seriesData = [];
            const nowTime = new Date().getTime();
            tasks.forEach((t) => {
                if (t.due && t.due.date) {
                    const endTime = t.due.datetime
                        ? new Date(t.due.datetime).getTime()
                        : new Date(t.due.date).getTime();
                    const start = nowTime;
                    seriesData.push({
                        x: t.content,
                        y: [start, endTime > start ? endTime : start + 86400000]
                    });
                } else {
                    seriesData.push({
                        x: t.content,
                        y: [nowTime, nowTime + 86400000]
                    });
                }
            });
            const el = document.getElementById("ganttChart");
            el.innerHTML = "";
            if (!seriesData.length) {
                el.innerHTML = "<p class='text-muted'>No tasks for Gantt.</p>";
                return;
            }
            const options = {
                chart: { type: "rangeBar", height: 400 },
                plotOptions: { bar: { horizontal: true } },
                series: [{ name: "Tasks", data: seriesData }],
                xaxis: { type: "datetime" },
                colors: ["#0dcaf0"]
            };
            const chart = new ApexCharts(el, options);
            chart.render();
        }
        function renderKanbanView(tasks) {
            const backlog = tasks.filter((t) => !isTaskDone(t) && !t.due);
            const inProgress = tasks.filter((t) => !isTaskDone(t) && t.due);
            const done = tasks.filter((t) => isTaskDone(t));
            return `
        <div class="row tasks-container">
          <div class="col-md-4 mb-3">
            <h5 class="mb-2">Backlog (${backlog.length})</h5>
            <div class="kanban-col task-dropzone" data-status="backlog">
              ${backlog.map((t) => renderTaskCard(t, false)).join("")}
            </div>
            <button class="btn btn-sm btn-outline-success addTaskBtn mt-2">
              <i class="bi bi-plus-circle"></i> Add Task
            </button>
          </div>
          <div class="col-md-4 mb-3">
            <h5 class="mb-2">In Progress (${inProgress.length})</h5>
            <div class="kanban-col task-dropzone" data-status="progress">
              ${inProgress.map((t) => renderTaskCard(t, false)).join("")}
            </div>
            <button class="btn btn-sm btn-outline-success addTaskBtn mt-2">
              <i class="bi bi-plus-circle"></i> Add Task
            </button>
          </div>
          <div class="col-md-4 mb-3">
            <h5 class="mb-2">Done (${done.length})</h5>
            <div class="kanban-col task-dropzone" data-status="done">
              ${done.map((t) => renderTaskCard(t, true)).join("")}
            </div>
            <button class="btn btn-sm btn-outline-success addTaskBtn mt-2">
              <i class="bi bi-plus-circle"></i> Add Task
            </button>
          </div>
        </div>`;
        }
        function renderTimelineView(tasks) {
            const seriesData = [];
            tasks.forEach((t) => {
                if (t.due && t.due.date) {
                    const time = t.due.datetime
                        ? new Date(t.due.datetime).getTime()
                        : new Date(t.due.date).getTime();
                    seriesData.push({ x: t.content, y: time });
                }
            });
            const el = document.getElementById("timelineChart");
            el.innerHTML = "";
            if (!seriesData.length) {
                el.innerHTML = "<p class='text-muted'>No tasks with due dates.</p>";
                return;
            }
            const options = {
                chart: { type: "scatter", height: 400 },
                xaxis: { type: "datetime" },
                series: [{ name: "Tasks Timeline", data: seriesData }],
                colors: ["#f012be"]
            };
            const chart = new ApexCharts(el, options);
            chart.render();
        }
        function renderStatsView(tasks) {
            const total = tasks.length;
            const doneCount = tasks.filter((t) => isTaskDone(t)).length;
            const incomplete = total - doneCount;
            const el = document.getElementById("statsChart");
            el.innerHTML = "";
            if (!tasks.length) {
                el.innerHTML = "<p class='text-muted'>No tasks.</p>";
                return;
            }
            const options = {
                chart: { type: "donut" },
                labels: ["Done", "Incomplete"],
                series: [doneCount, incomplete],
                colors: ["#198754", "#dc3545"],
                legend: { position: "bottom" }
            };
            const chart = new ApexCharts(el, options);
            chart.render();
        }
        function renderPriorityView(tasks) {
            if (!tasks.length) return "<p>No tasks.</p>";
            const sorted = [...tasks].sort((a, b) => (a.priority || 4) - (b.priority || 4));
            let html = "<ul class='list-group tasks-container'>";
            html += `<button class="btn btn-sm btn-outline-success addTaskBtn mb-2">
        <i class="bi bi-plus-circle"></i> Add Task
      </button>`;
            sorted.forEach((t) => {
                const doneClass = isTaskDone(t) ? "done" : "";
                html += `<li class="list-group-item task-card ${doneClass}" draggable="true" data-task-id="${t.id}">
          <strong>P${t.priority || 4} - ${t.content}</strong>
          <div class="extended-info">
            ${t.description ? `Desc: ${t.description}<br/>` : ""}
            ${t.due ? `Due: ${t.due.date || ""} ${t.due.datetime || ""}<br/>` : ""}
          </div>
        </li>`;
            });
            html += "</ul>";
            return html;
        }
        function renderOverdueView(tasks) {
            const now = Date.now();
            const overdue = tasks.filter((t) => {
                if (!t.due) return false;
                const time = t.due.datetime
                    ? new Date(t.due.datetime).getTime()
                    : new Date(t.due.date).getTime();
                return time < now && !isTaskDone(t);
            });
            if (!overdue.length) return "<p>No overdue tasks.</p>";
            let html = "<ul class='list-group tasks-container'>";
            html += `<button class="btn btn-sm btn-outline-success addTaskBtn mb-2">
        <i class="bi bi-plus-circle"></i> Add Task
      </button>`;
            overdue.forEach((t) => {
                html += `<li class="list-group-item task-card text-danger fw-bold" draggable="true" data-task-id="${t.id}">
          ${t.content} - Due ${t.due.date || ""} ${t.due.datetime || ""}
        </li>`;
            });
            html += "</ul>";
            return html;
        }
        function isTaskDone(t) {
            return !!(t.completed || t.is_completed);
        }
        function initDragDrop() {
            document.querySelectorAll(".task-card").forEach((card) => {
                card.addEventListener("dragstart", (e) => {
                    e.dataTransfer.setData("text/plain", card.getAttribute("data-task-id"));
                });
            });
            document.querySelectorAll(".task-dropzone").forEach((zone) => {
                zone.addEventListener("dragover", (e) => {
                    e.preventDefault();
                    zone.classList.add("drag-over");
                });
                zone.addEventListener("dragleave", () => {
                    zone.classList.remove("drag-over");
                });
                zone.addEventListener("drop", (e) => {
                    e.preventDefault();
                    zone.classList.remove("drag-over");
                    const id = e.dataTransfer.getData("text/plain");
                    const card = document.querySelector(`[data-task-id="${id}"]`);
                    if (card) zone.appendChild(card);
                    showAlert("Moved task (no actual API update in demo).", "info");
                });
            });
        }
        function fadeInContent() {
            mainContent.classList.remove("fade-anim");
            setTimeout(() => mainContent.classList.add("fade-anim"), 10);
            initDragDrop();
        }
        function showAlert(msg, type = "info") {
            const alertDiv = document.createElement("div");
            alertDiv.className = `alert alert-${type} d-flex align-items-center fade show`;
            alertDiv.innerHTML = `
        <i class="bi bi-info-circle-fill me-2"></i>
        <div>${msg}</div>
      `;
            alertArea.appendChild(alertDiv);
            setTimeout(() => {
                alertDiv.classList.remove("show");
                setTimeout(() => {
                    if (alertDiv.parentNode) alertDiv.parentNode.removeChild(alertDiv);
                }, 300);
            }, 3000);
        }
        if (apiKey) {
            fetchBtn.click();
        }
    </script>
</body>

</html>